<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html dir="ltr"><head>








  
  <meta content="text/html;charset=windows-1251" http-equiv="Content-Type"><title>Era II</title>
  

  
  
  <meta content="Berserker" name="author"></head><body>
<span style="color: rgb(255, 0, 0); font-weight: bold;">Концепция модов.</span><br>Мод
- это набор файлов и папок, включая графику, аудио, видео, скрипты,
модули, заплатки и пользовательские файлы. Эра вводит папку <span style="font-style: italic;">"Mods"</span>, в которой каждая подпапка зовётся модом и обрабатывается так, словно она является корневой папкой игры.
Это значит, что файлы и папки в модах должны иметь такую же организационную структуру, как и в самой игре.<br>

<br>

<span style="font-style: italic;">Оригинальная</span> игра:<span style="font-style: italic;"> </span>Data<br>

<span style="font-style: italic;">Мод</span>: Mods\Название Моего Мода\Data<span style="font-weight: bold;"><br>
<br>
Содержимое модов.</span><br>Содержимое модов не должно меняться во
время игрового процесса. Изменяемые файлы (такие как настройки,
журналы, временные) следует помещать в реальные игровые папки во время
установки. Несколько модов могут одновременно существовать в папке
Mods, при условии, что они являются совместимыми. Каждый мод может
содержать неограниченно количество игровых ресурсов (snd/vid/pac архивы
в Data), которые будут подгружены автоматически.<br>

<br>

<span style="font-weight: bold;">Приоритеты.</span><br>Если в
каком-либо из модов есть файл с таким же именем, как и в оригинальной
игре, то он используется вместо оригинального. Если в нескольких модах
имеется файл с одним и тем же именем, то используется мод с наибольшим
приоритетом. Чтобы назначить приоритет моду, нужно добавить число к
началу его имени, отделив число пробелом от остального текста. Чем
больше число - тем больше приоритет. Например: "100 МойМод". Если
приоритет не указан, то он равняется 0. В случае равных приоритетов
сравниваются даты создания папок модов и наиболее "свежей" папке
отдаётся предпочтение при поиске. Такой механизм гарантирует, что моды,
которые устанавливаются позже, будут иметь приоритет над теми, что были
установлены ранее.<br>

<br>

<span style="font-style: italic;">Подсказка, как задать папке текущее время в качестве даты создания.</span><br>Выполните "Tools\installmod.exe" с именем мода в качестве единственного аргумента.<br>
<br>Оригинальные snd/vid архивы грузятся в следующем порядке:<br>
<ul>
  <li>heroes3.vid с CD</li>
  <li>video.vid</li>
  <li>h3ab_ahd.vid</li>
</ul>
<ul>
  <li>heroes3.snd с CD</li>
  <li>heroes3.snd</li>
  <li>h3ab_ahd.snd<br>
  </li>
</ul>


<br>

<span style="font-weight: bold;">Мод ВоГ.</span><br>

ВоГ теперь распространяется в качестве обычного мода и, таким образом, не заменяет игровые файлы. Б<span style="font-weight: bold;">о</span>льшая
часть воговских ресурсов расположена в архиве "Data\hmm35wog.pac".
Все диалоги ВоГ читают этот архив напрямую, игнорируя другие моды.
Единственный, не рекомендуемый способ, как исправить такое поведение -
это импортировать новые диалоговые данные в hmm35wog.pac. ВоГ содержит
исправленный деф палатки первой помощи, что должно избавить игроков от
зависаний.<br>

<br>

<span style="font-weight: bold;"></span><span style="font-style: italic;">Дополнительные опциональные изменения</span>:<br>

<ul>

  <li>Быстрая анимация в бою. Для отключения удалите файл <span style="font-style: italic;">"Data\cranim.txt"</span>.</li>
  <li>Нет предбитвенных мелодий. Для отключения удалите файл <span style="font-style: italic;">"Data\wog - no
prebattle music.snd"</span>.</li>
  <li>Анимированные объекты Героев 3. Для отключения удалите файл <span style="font-style: italic;">"Data\wog -
animated objects.pac"</span>.</li>
  <li>Анимированные деревья. Для отключения удалите файл <span style="font-style: italic;">"Data\wog - animated
trees.pac"</span>.</li>
  <li>Украшения (препятствия) в боях. Для отключения удалите файл <span style="font-style: italic;">"Data\wog - battle
decorations.pac"</span>.</li>
</ul>

<span style="font-weight: bold;">Мод Yona.</span><br>
Yona - это мод с открытым исходным кодом, написанный на чистом Delphi с
использованием Era SDK. Его идеологией являются полная опциональность (<span style="font-style: italic;">"Data\Yona\settings.ini"</span>),
родная поддержка всех нововведений игрой, ИИ и многопользовательский
код. Мод совместим с другими модами, не хранит данных в сохранениях и
не изменяет ERM скрипты. Для удаления мода удалите папку <span style="font-style: italic;">"Mods\Yona"</span>.<br>

<br>

<span style="font-style: italic;">Свойства</span>: <br>Новая подсказка
в журнале боя покажет в геройском стиле вероятное число убитых
противников, средние значения, смертельные значения и новые способности
при выбранной атаке.<br>

<br>

<span style="font-style: italic;">Новые способности</span>: <br>

<ul>

  <li>Копейщики/Алебардщики игнорируют кавалерийских бонус и наносят 200% урона кавалерии:</li>
  
  <ul>

    <li>Кавалеристам</li>
    <li>Чемпионам</li>
    <li>Кентаврам</li>
    <li>Капитанам Кентавров<br>
</li>
    <li>Единорогам</li>
    <li>Боевым Единорогам<br>
</li>
    <li>Чёрным Рыцарям<br>
</li>
    <li>Рыцарям Смерти<br>
</li>
    <li>Кочевникам</li>
    <li>Сильванским Кентаврам<br>
</li>
    <li>Пожарам</li>
    <li>Кошмарам</li>
  
  </ul>

  <li>Кавалеристы
/ Чемпионы получают 20% бонус к урону за каждую пройденную клетку
вместо оригинальных 5%. Бонус складывается с другими, например
модификатором параметра "Атака" или навыка "Нападение".</li>
  <li>Рыцари/Крестоносцы игнорируют 50% физического урона в состоянии обороны.</li>
  <li>Урон Орков/Орков-вождей (метание топоров) зависит квадратично от расстояния до цели.<br>
Формула: Базовый урон * (19 - расстояние)<sup>2</sup> / 100.</li>
</ul>

<br>
<span style="font-weight: bold;">Мод "Прокрутка вторичных навыков".</span><br>Добавляет
кнопки прокрутки справа от списка вторичных навыков в окне героя,
позволяя просматривать и оперировать более чем восемью навыками.<br>
<br>
<br>

<span style="font-weight: bold; color: red;">Изменения.</span><br>

<br>

<span style="font-weight: bold;">Переносимость.</span><br>

Игра стала полностью переносимой. Все игровые настройки хранятся в файле <span style="font-style: italic;">"heroes3.ini"</span>. Родной механизм сканирования CD-дисков отключён. Эра автоматически загружает файлы <span style="font-style: italic;">".\Heroes3\Data\heroes3.vid"</span> и
<span style="font-style: italic;">".\Heroes3\Data\heroes3.snd"</span> при их наличии. Если опция <span style="font-style: italic;">"LoadCD"</span> (Загружать CD) в <span style="font-style: italic;">"heroes3.ini"</span> установлена в 1, то Эра сканирует все CD-приводы в поисках папки <span style="font-style: italic;">"Heroes3"</span>. Если вышеописанные snd/vid архивы не найдены в игровой папке, Эра попытается подгрузить их с CD-диска при условии, что опция <span style="font-style: italic;">"LoadCD"</span> включена.<br>

<br>

<span style="font-style: italic;">Отладочный режим</span>.<br>Для включения отладочного режима установите опцию <span style="font-style: italic;">"Debug"</span> в 1. Файл <span style="font-style: italic;">"eralog.txt"</span>
будет автоматически создан при старте игры.<br style="font-weight: bold;">

<br>
<span style="font-weight: bold;">Расширяемость.</span><br style="font-weight: bold;">Все erm файлы (и ert файлы с такими же именами) автоматически подгружаются из папки <span style="font-style: italic;">"Data\s"</span>
при старте карты или нажатии клавиши F12. Диалог ВоГ-опций больше не
проверяет наличие файлов на диске. Количество скриптов ограничено
только размерами внутренней памяти. Если правильное (положительное или
отрицательное) число стоит перед именем файла (например, "50
Проверка.erm"), то оно расценивается как приоритет загрузки (чем выше,
тем раньше грузится скрипт). Если файл <span style="font-style: italic;">"load only these scripts.txt"</span> (загружать только эти скрипты) существует в папке <span style="font-style: italic;">"Data\s"</span>,
то только те скрипты, которые указаны в этом файле (по одному скрипту
на строку), будут загружены. В этом случае порядок загрузки скриптов
определяется порядком их упоминания в списке. Опция ВоГ-настроек "<span style="font-style: italic;">Alternate_Script_Location"</span> больше не используется.<br>
<br style="font-weight: bold;">

<span style="font-weight: bold;">Многопользовательская игра.<br>
</span>
<ul>

  <li>Между двумя копиями игры на одном компьютере возможна сетевая игра, если у копий разные значения параметра <span style="font-style: italic;">"Unique System ID"</span> в файле <span style="font-style: italic;">"heroes3.ini"</span>. Для того, чтобы сгенерировать новый ID, удалите строку с данной настройкой и запустите игру.</li>
  <li>Механизм
определения внешнего IP адреса был улучшен. Первый адрес не из
локальной сети перемешается в начало списка адресов, возвращаемого
функцией gethostbyname.</li>
</ul>

<span style="font-weight: bold;">Редакторы.</span><br>Оригинальные
редакторы (h3maped.exe and h3ccmped.exe) работают хорошо. ВоГ редакторы
(h3wmaped.exe и h3wcmped.exe) могут нуждаться в дополнительном
исправлении. Воговский редактор правильно открывает карты и загружает
моды. Он также применяет все заплатки для памяти и загружает
dll-библиотеки из папки EraEditor. Расширенная функциональность
редактора, обеспечиваемая патчем от GrayFace требует, чтобы ресурсы
были физически расположены в файлах h3sprite.lod и h3bitmap.lod.
Воговский редактор кампаний не поддерживает модов. Для того, чтобы
MapEdPatch (патч для редактора карт) работал с новыми ВоГ-объектами , а
также чтобы заработал редактор кампаний ВоГ, картостроитель должен
запустить <span style="font-style: italic;">"Tools\Fix
Editor\Fix Editor.bat"</span>. Этот пакетный файл импортирует все критически данные в h3sprite.lod и h3bitmap.lod.<br>
<br style="font-weight: bold;">
<span style="font-weight: bold;">Поддержка пользовательских кнопок.<br>
</span>Стало возможным иметь пользовательские кнопки в большинстве
игровых экранов. Оригинальный модуль под авторством MoP-а (Buttons.dll)
был изменён и теперь является частью Эры. Пользовательские кнопки
описываются в <span style="font-style: italic;">*.btn </span>файлах, которые подгружаются из папки <span style="font-style: italic;">"Data\Buttons"</span> при старте игры.<br>
<br>

<span style="font-weight: bold;">Помощь.</span><br>Вся документация, истории изменений, обновлённые руководства по ERM и Эре могут быть найдены в папке <span style="font-style: italic;">"Help"</span>.<br>
<br>

<span style="font-weight: bold;">Улучшения.</span><br>

<ul>

  <li>Совместимость с Windows 7 при запуске без опции "Совместимость с XP".</li>
  <li>Больше нет ВоГ-инсталлятора.<br>
  </li>
  <li>Ускорен вызов всех воговских диалогов, в несколько раз меньше нагрузка на жёсткий диск.</li>
  <li>Оптимизированы ВоГ-диалоги, значительно снижена нагрузка на процессор. Заплатка <span style="font-style: italic;">"reduce cpu load.bin"</span>
была удалена и опция HD-мода <span style="font-style: italic;">"Berserker's CPU
patch"</span> тоже должна быть выключена.</li>
  <li>Запись ini-файлов через функции ERM или Эры теперь приводит к сортированному списку секций и ключей вместо бывшего хаотичного.</li>
  <li>Генерация случайных карт в игре и редакторе больше не зависит от мусорных
snd/vid/lod файлов из Клинка Армагеддона.</li>
  <li>Игра не требует наличия родных lod-архивов в папке "Data", если все необходимые ресурсы присутствуют в других pac-архивах.<br>
  </li>
  <li>Добавлены синхронизированные звуки существ от GrayFace.</li>
  <li>Script
98 (быстрые и умные сохранения) был переписан, теперь поддерживает
опцию в ВоГ-меню, не конфликтует с чатом и совместим с другими
скриптами.<br>
</li>
  <li>Все вспомогательные программы были перемещены в папку <span style="font-style: italic;">"Tools"</span>, включая новые стандартные:<br>
lodexport, lodimport, objector.exe, repman.exe, resman.exe,
installmod.exe.</li>
  <li>Обновлены API и исходники.</li>
  <li>F11 теперь извлекает скрипты из памяти в папку <span style="font-style: italic;">"Data\ExtractedScripts"</span>
вместо "Data\s\ExtractedScripts".</li>
  <li>Удалён дублирующий код ВоГ-инициализации.</li>
  <li>Исправлены баги Эры 1.9 в области PO/Доп. памяти, которые приводили к неверному размеру сохранённых игр и испорченным данным.</li>
  <li>Исправлен баг Эры 1.9, при котором модули с расширение <span style="font-style: italic;">".off"</span> всё равно загружались.<br>
  </li>
</ul>

<br>

<span style="font-weight: bold; color: red;">Технические детали.</span><br>

<br>
<span style="font-weight: bold;">Поддержка пользовательских кнопок.</span><br>Каждый <span style="font-style: italic;">*.btn</span> файл (чистый txt-формат) содержит строки (по одной на кнопку) в следующем формате:<br>
[Экран кнопки];[Уникальное имя кнопки];[DEF
кнопки;[X];[Y];[Ширина];[Высота];[Длинное описание];[Короткое
описание];[Код горячей клавиши],<br>где "Экран кнопки" может принимать одно из следующих значений:<br>

<ul>
<li>Advmap (для карты приключений)<br>
</li><li>Town (для города)<br>
</li><li>Hero (для экрана героя)<br>
</li><li>Heroes (для экрана встречи героев)<br>
</li><li>Battle (для битвы)<br>
</li><li>Dummy (если кнопка не используется)<br>
  </li>
</ul>Каждой кнопке автоматически назначается уникальный идентификатор
(ID), который можно получить через вызов stdcall функции "GetButtonID"
из библиотеки Era.dll с именем кнопки в качестве единственного
аргумента. Если указанное имя не было зарегистрировано, то функция
вернёт -1.<br>
<br>
Для окна встречи героев теперь действует событие !?FU66666, возникающее
при щелчке на любой кнопке. Аргументы (x1..x2): ID кнопки, Блокировать
реакцию по умолчанию?<br>
<br>

<span style="font-weight: bold;">Виртуальная Файловая Система (Поддержка папки "Mods").</span><br>Поддерживается следующий набор функций, работающих с именами в файловой системе:<br>

<ul>

  <li>CreateFileA</li>
  <li>GetFileAttributesA</li>
  <li>FindFirstFileA</li>
  <li>FindNextFileA</li>
  <li>FindClose</li>
  <li>LoadLibraryA</li>
  <li>DeleteFileA</li>
  <li>CreateDirectoryA</li>
  <li>RemoveDirectoryA</li>
  <li>GetPrivateProfileStringA</li>
  <li>LoadCursorFromFileA</li>
  <li>PlaySoundA</li>
  <li>GetCurrentDirectoryA</li>
  <li>SetCurrentDirectoryA</li>
</ul>

<span style="font-weight: bold;">Новое событие "OnStackToStackDamage"
(!?FU77012). </span>(При расчёте урон типа "отряд-по-отряду")<br>

Аргументы:<br>

<ul>

  <li>Атакующий отряд (0..41) или -1</li>
  <li>Защищающийся отряд (0..41) или -1</li>
  <li>Конечный урон (НЕ МЕНЯТЬ!)</li>
  <li>Конечный урон (ИЗМЕНЯЕМЫЙ)</li>
  <li>Базовый урон<br>
</li>
  <li>Бонус урона<br>
</li>
  <li>Дальняя атака? (если не 0 или 1, то содержит мусор)</li>
  <li>Расстояние (только для теоретических атак установлено)</li>
  <li>Теоретическая атака? (расчёт для подсказки или ИИ)</li>
</ul>Событие возникает, когда один отряд атакует или стреляет в другой.<br>

<br>

<span style="font-weight: bold;">Новое событие "OnAICalcStackAttackEffect"
(!?FU77013). </span>(ИИ расчитывает эффект от атаки на отряд)<br>

Аргументы:<br>

<ul>

  <li>Атакующий отряд (0..41)</li>
  <li>Защищающийся отряд (0..41)</li>
  <li>Значение эффекта (ИЗМЕНЯЕМОЕ)</li>
  <li>Значение эффекта (НЕ МЕНЯТЬ)</li>
</ul>

<span style="font-weight: bold;">Новое событие "OnChat" (!?FU77014). </span>(При чате)<br>Первый аргумент определяет тип события и остальные аргументы.<br>

<ul>

  <li>0 (Вход в чат)</li>
  
  <ul>

    <li>Запретить вход? (0..1)</li>
  
  </ul>

  <li>1 (Ввод)</li>
  
  <ul>

    <li>Строка ввода<br>
</li>
    <li>Действие: 0 (очистить панель), 1 (закрыть панель) или 2 (по умолчанию)</li>
  
  </ul>

  <li>2 (Выход из чата)</li>
</ul>

<span style="font-weight: bold;">Разное.</span><br>

<ul>

  <li>Добавлена функция "ApiHook". Она определяет минимальный размер заплатки самостоятельно, в отличие от функции "Hook".</li>
  <li>И
"ApiHook" и "Hook" функции теперь возвращают новый адрес затёртого кода
в режиме моста (BRIDGE), что позволяет вызывать также и оригинальные
функции, минуя установленные перехватчики.</li>
  <li>v1 содержит описатель библиотеки Era dll во время загрузки <span style="font-style: italic;">*.era</span> модулей.</li>
  <li>Эра автоматически вызывает функцию DisableThreadLibraryCalls для всех загружаемых
    <span style="font-style: italic;">*.era</span> модулей.</li>
  <li>ExecErmCmd больше не убивает игру при ошибке.</li>
  <li>Событие "OnNameColors" было переименовано в "OnAfterCreateWindow"
</li>
</ul></body></html>